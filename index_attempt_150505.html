<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Line Chart with Multiple Lines</title>
		<script type="text/javascript" src="../d3.v3.js"></script>
		<link rel="stylesheet" type="text/css" href="style.css">

	</head>
	<body>

		<p>
			<div id = "dropdown"> 
					<!-- discipline dropdown -->
				<p id = "discipline">
					<!-- space to insert selected discipline -->
				</p>
			</div>
			<div id ="seed_label"> </div>
		  <label for="seed" 
      	style="display: inline-block; width: 240px; text-align: right">
      	below / above grade level  <span id="seed-value"></span>
		  </label>
		  <input type="range" min="140" max="176" id="seed">
		</p>


		<script type="text/javascript" src = "../helper.js"> </script>		
		<script> 

			var subject = "Reading"

	    select_dropdown = d3.select("#dropdown")
      			.append("select")

			select_dropdown.selectAll("option")
		      	.data(["Reading","Mathematics"])
		      	.enter()
		        .append("option")
		        .attr("value", function (d) { return d; }) 
		        .text(function (d) { return d; }) ;
		        .select("value","Mathematics");

		 //TODO: figure out how to call the child element of #dropdown 
		 	 // child element (select)
		 	 // value ()
		 // TODO: populate <p id = discipline> with child item use that to call selected data point 
			var select_subject = d3.select("select")
	    var select_seed = d3.select("#seed")

		// TODO: fix the event listener so that the dropdown and slider does not conflict
		// TODO: create an assumption for summer slide 
		// TODO: switch to fall to spring growth (when summer slide incorporated)


		// DEFINE VISUALIZATION SETTING
			var h = 400;
			var w = 600;
			var padding = { top: 20, right: 10, bottom: 20,left: 10 };  //Top, right, bottom, left


			var widthScale = d3.scale.ordinal()
								.rangeBands([ 0, w- padding.left - padding.right  ]);
			
			var heightScale = d3.scale.linear()
								.range([ 0, h - padding.top - padding.bottom ]);

			var xAxis = d3.svg.axis()
				.scale(widthScale)
				.orient("bottom");

			var yAxis = d3.svg.axis()
				.scale(heightScale)
				.orient("left");

			var svg = d3.select("body")
				.append("svg")
				.attr("width", w)
				.attr("height", h);

			// add paragraph 
			d3.select("#seed_label").append("p").text("In 1st grade, we assume student start out at 0 grade level below their peers"); 

			// TODO: create a dropdown to pick discipline
			d3.csv("nwea_expected_growth_map.csv", function(growth_data) {

				d3.csv("nwea_ongrade_rit.csv", function(grade_data_all) {

					// create function to format by year
					var dateFormat = d3.time.format("%Y");

					// subset of fall data 
					var fall_grade_data = grade_data_all.filter(function(d) { 
											return d.term  == "FA";
										});

					// filter out only data for selected discipline
					var grade_data_subject = fall_grade_data.filter(function(d) { 
											return d.discipline  == "Reading";
										});

					//ordinal scale 
					widthScale.domain(d3.range(1,7));

					//linear - 5 is closest to top and -5 to bottom
					heightScale.domain([5,-5]);

						
					//TODO: color code the data with red, pink, yellow, light green, dark green
					var selected_seed = 160
					var simulation = createSimul(selected_seed
												,grade_data_subject
												,growth_data)	

					var rects = drawRect(simulation)



					// recreate when selected subject change
					// console.log(rects)
			    select_dropdown
				      .on("click", function(d) {

				      	console.log(this.value)
				    	//var subjectID = d3.select(this).attr("id")

					    //console.log(subjectID)	
					   //    // var subject = this.value;
								// var grade_data_subject = fall_grade_data.filter(function(d) { 
								// 			return d.discipline  == subjectID;
								// 		});

								// console.log(grade_data_subject);


								// var simulation = createSimul(160
								// 						,grade_data_subject
								// 						,growth_data)	;

								// var rects = transitionRect(simulation);						

				   });


					// recreate when seed rit change
					select_seed.on("click",function(){
								console.log(subject);

								var selected_seed = +this.value 

								var simulation = createSimul(+this.value
														,grade_data_subject
														,growth_data)	

								console.log(simulation)

								var rects = transitionRect(simulation)
							      
					})

					svg.append("g")
						.attr("class", "x axis")
						.attr("transform", "translate(" + padding.left + "," + (heightScale(0) ) + ")")
						.call(xAxis);

					svg.append("g")
						.attr("class", "y axis")
						.attr("transform", "translate(" + (padding.bottom ) + ",0)")
						.call(yAxis);



				})

			})


		</script>
	</body>



